<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Random Attack</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;700&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#233d4d" />
  <style>
    body {
      font-family: 'Lexend', sans-serif;
      background-color: #233d4d;
      color: #f7fff7;
      margin: 0;
      overflow: hidden;
    }
    #root {
      height: 100vh;
      width: 100vw;
      background-color: #233d4d;
    }
    @keyframes circle-timer {
      from {
        stroke-dashoffset: 0;
      }
      to {
        stroke-dashoffset: 471;
      }
    }
    @keyframes circle-timer-10s {
      from {
        stroke-dashoffset: 0;
      }
      to {
        stroke-dashoffset: 942;
      }
    }
    .timer-circle {
      transform: rotate(-90deg);
      transform-origin: center;
    }
    .timer-circle-path {
      stroke-dasharray: 471;
      animation: circle-timer 5s linear forwards;
    }
    .timer-circle-path-10s {
      stroke-dasharray: 942;
      animation: circle-timer-10s 10s linear forwards;
    }
  </style>
</head>
<body class="h-screen w-screen overflow-hidden">
  <div id="root"></div>
  <script type="text/babel">
    const StartScreen = ({ setCurrentScreen, isHajimeCounterEnabled, isAutoModeEnabled, playSound, hajimeBuffer }) => {
      console.log('StartScreen rendered', { isHajimeCounterEnabled, isAutoModeEnabled });
      const [isSidebarOpen, setIsSidebarOpen] = React.useState(false);

      const handleClick = (screen) => {
        console.log(`Navigating to ${screen}`);
        setCurrentScreen(screen);
        setIsSidebarOpen(false);
      };

      if (isAutoModeEnabled) {
        return (
          <div className="relative flex flex-col items-center justify-center h-screen w-screen bg-midnight-green text-mint-cream">
            <button
              className="absolute top-4 right-4 w-8 h-8 flex flex-col justify-center items-center bg-transparent"
              onClick={() => setIsSidebarOpen(true)}
            >
              <span className="w-6 h-1 bg-gray-800 mb-1 rounded"></span>
              <span className="w-6 h-1 bg-gray-800 mb-1 rounded"></span>
              <span className="w-6 h-1 bg-gray-800 rounded"></span>
            </button>
            <h1 className="text-4xl font-medium mb-12">Random Attack</h1>
            <button
              className="w-48 h-48 rounded-full bg-robin_egg_blue text-white text-2xl font-semibold hover:bg-robin_egg_blue-600 transition"
              onClick={() => handleClick('attacker')}
            >
              Start
            </button>
            <div
              className={`fixed top-0 right-0 h-full w-1/2 bg-gray-800 bg-opacity-90 backdrop-blur-md shadow-2xl transform transition-transform duration-300 ${
                isSidebarOpen ? 'translate-x-0' : 'translate-x-full'
              }`}
              style={{ boxShadow: isSidebarOpen ? '-10px 0 15px -3px rgba(0, 0, 0, 0.5)' : 'none' }}
            >
              <div className="flex flex-col h-full justify-between p-4">
                <div className="flex flex-col gap-4">
                  <h2 className="text-2xl font-bold text-mint-cream">Menü</h2>
                  <div
                    className="text-lg text-mint-cream hover:underline cursor-pointer"
                    onClick={() => handleClick('info')}
                  >
                    Info
                  </div>
                  <div
                    className="text-lg text-mint-cream hover:underline cursor-pointer"
                    onClick={() => handleClick('attacks')}
                  >
                    Angriffe
                  </div>
                  <div
                    className="text-lg text-mint-cream hover:underline cursor-pointer"
                    onClick={() => handleClick('defense')}
                  >
                    Abwehr
                  </div>
                  <div
                    className="text-lg text-mint-cream hover:underline cursor-pointer"
                    onClick={() => handleClick('settings')}
                  >
                    Einstellungen
                  </div>
                </div>
                <button
                  className="w-8 h-8 rounded-full bg-gradient-to-br from-red-600 to-light_red text-mint-cream text-lg font-light flex items-center justify-center shadow-inner shadow-sm hover:shadow-inner transition self-end"
                  onClick={() => setIsSidebarOpen(false)}
                >
                  X
                </button>
              </div>
            </div>
          </div>
        );
      }

      return (
        <div className="relative flex flex-col items-center justify-start h-screen w-screen bg-midnight-green text-mint-cream">
          <button
            className="absolute top-4 right-4 w-8 h-8 flex flex-col justify-center items-center bg-transparent"
            onClick={() => setIsSidebarOpen(true)}
          >
            <span className="w-6 h-1 bg-gray-800 mb-1 rounded"></span>
            <span className="w-6 h-1 bg-gray-800 mb-1 rounded"></span>
            <span className="w-6 h-1 bg-gray-800 rounded"></span>
          </button>
          <h1 className="text-4xl font-medium mb-12 pt-12">Random Attack</h1>
          <div className="flex flex-col gap-6">
            <button
              className="w-36 h-36 rounded-full bg-robin_egg_blue text-white text-lg font-semibold hover:bg-robin_egg_blue-600 transition"
              onClick={() => handleClick('uke')}
            >
              Uke
            </button>
            <button
              className="w-36 h-36 rounded-full bg-robin_egg_blue text-white text-lg font-semibold hover:bg-robin_egg_blue-600 transition"
              onClick={() => handleClick('tori')}
            >
              Tori
            </button>
            <button
              className="w-36 h-36 rounded-full bg-light_red text-white text-lg font-semibold hover:bg-light_red-600 transition"
              onClick={() => {
                console.log('Hajime button clicked');
                if (!isHajimeCounterEnabled) {
                  playSound(hajimeBuffer, 'hajime');
                }
                handleClick('hajime');
              }}
            >
              Hajime
            </button>
          </div>
          <div
            className={`fixed top-0 right-0 h-full w-1/2 bg-gray-800 bg-opacity-90 backdrop-blur-md shadow-2xl transform transition-transform duration-300 ${
              isSidebarOpen ? 'translate-x-0' : 'translate-x-full'
            }`}
            style={{ boxShadow: isSidebarOpen ? '-10px 0 15px -3px rgba(0, 0, 0, 0.5)' : 'none' }}
          >
            <div className="flex flex-col h-full justify-between p-4">
              <div className="flex flex-col gap-4">
                <h2 className="text-2xl font-bold text-mint-cream">Menü</h2>
                <div
                  className="text-lg text-mint-cream hover:underline cursor-pointer"
                  onClick={() => handleClick('info')}
                >
                  Info
                </div>
                <div
                  className="text-lg text-mint-cream hover:underline cursor-pointer"
                  onClick={() => handleClick('attacks')}
                >
                  Angriffe
                </div>
                <div
                  className="text-lg text-mint-cream hover:underline cursor-pointer"
                  onClick={() => handleClick('defense')}
                >
                  Abwehr
                </div>
                <div
                  className="text-lg text-mint-cream hover:underline cursor-pointer"
                  onClick={() => handleClick('settings')}
                >
                  Einstellungen
                </div>
              </div>
              <button
                className="w-8 h-8 rounded-full bg-gradient-to-br from-red-600 to-light_red text-mint-cream text-lg font-light flex items-center justify-center shadow-inner shadow-sm hover:shadow-inner transition self-end"
                onClick={() => setIsSidebarOpen(false)}
              >
                X
              </button>
            </div>
          </div>
        </div>
      );
    };

    const SettingsScreen = ({ isHajimeCounterEnabled, setIsHajimeCounterEnabled, isAutoModeEnabled, setIsAutoModeEnabled, setCurrentScreen }) => {
      const toggleHajimeCounter = () => {
        setIsHajimeCounterEnabled((prev) => !prev);
      };

      const toggleAutoMode = () => {
        setIsAutoModeEnabled((prev) => !prev);
      };

      return (
        <div className="flex flex-col items-center justify-start h-screen w-screen p-6 bg-midnight-green text-mint-cream overflow-hidden select-none">
          <h1 className="text-3xl font-bold mb-4 pt-8">Einstellungen</h1>
          <div className="flex flex-col gap-4 w-full max-w-md overflow-y-auto">
            <div className="flex items-center justify-between">
              <span className="text-lg">Hajime Counter</span>
              <button
                className={`w-12 h-6 rounded-full p-1 flex items-center transition-colors ${
                  isHajimeCounterEnabled ? 'bg-robin_egg_blue' : 'bg-gray-400'
                }`}
                onClick={toggleHajimeCounter}
              >
                <div
                  className={`w-4 h-4 rounded-full bg-white shadow-md transform transition-transform ${
                    isHajimeCounterEnabled ? 'translate-x-6' : 'translate-x-0'
                  }`}
                ></div>
              </button>
            </div>
            <div className="flex items-center justify-between">
              <span className="text-lg">Auto Modus</span>
              <button
                className={`w-12 h-6 rounded-full p-1 flex items-center transition-colors ${
                  isAutoModeEnabled ? 'bg-robin_egg_blue' : 'bg-gray-400'
                }`}
                onClick={toggleAutoMode}
              >
                <div
                  className={`w-4 h-4 rounded-full bg-white shadow-md transform transition-transform ${
                    isAutoModeEnabled ? 'translate-x-6' : 'translate-x-0'
                  }`}
                ></div>
              </button>
            </div>
          </div>
          <button
            className="fixed bottom-4 left-1/2 -translate-x-1/2 w-12 h-12 rounded-full bg-gradient-to-br from-red-600 to-light_red text-mint-cream text-xl font-light flex items-center justify-center shadow-inner shadow-sm hover:shadow-inner transition"
            onClick={() => {
              console.log('Navigating to start from Settings');
              setCurrentScreen('start');
            }}
          >
            X
          </button>
        </div>
      );
    };

    const AttackerScreen = ({ setCurrentScreen }) => {
      const [timer, setTimer] = React.useState(5);

      React.useEffect(() => {
        const interval = setInterval(() => {
          setTimer((prev) => {
            if (prev <= 1) {
              clearInterval(interval);
              setCurrentScreen('attacks');
              return 0;
            }
            return prev - 1;
          });
        }, 1000);

        return () => clearInterval(interval);
      }, [setCurrentScreen]);

      return (
        <div className="flex flex-col items-center justify-center h-screen w-screen p-6 bg-midnight-green text-mint-cream overflow-hidden select-none">
          <h1 className="text-3xl font-bold mb-4">Angreifer</h1>
          <div className="relative flex items-center justify-center">
            <svg width="300" height="300" className="timer-circle">
              <circle
                cx="150"
                cy="150"
                r="75"
                stroke="#f7fff7"
                strokeWidth="4"
                fill="none"
                className="timer-circle-path"
              />
            </svg>
            <div className="absolute text-8xl font-bold">{timer}</div>
          </div>
        </div>
      );
    };

    const DefensePrepScreen = ({ setCurrentScreen }) => {
      const [timer, setTimer] = React.useState(5);

      React.useEffect(() => {
        const interval = setInterval(() => {
          setTimer((prev) => {
            if (prev <= 1) {
              clearInterval(interval);
              setCurrentScreen('defense');
              return 0;
            }
            return prev - 1;
          });
        }, 1000);

        return () => clearInterval(interval);
      }, [setCurrentScreen]);

      return (
        <div className="flex flex-col items-center justify-center h-screen w-screen p-6 bg-midnight-green text-mint-cream overflow-hidden select-none">
          <h1 className="text-3xl font-bold mb-4">Verteidigung</h1>
          <div className="relative flex items-center justify-center">
            <svg width="300" height="300" className="timer-circle">
              <circle
                cx="150"
                cy="150"
                r="75"
                stroke="#f7fff7"
                strokeWidth="4"
                fill="none"
                className="timer-circle-path"
              />
            </svg>
            <div className="absolute text-8xl font-bold">{timer}</div>
          </div>
        </div>
      );
    };

    const GetReadyScreen = ({ setCurrentScreen, playSound, beepBuffer, hajimeBuffer }) => {
      const [timer, setTimer] = React.useState(10);

      React.useEffect(() => {
        const interval = setInterval(() => {
          setTimer((prev) => {
            if (prev <= 1) {
              clearInterval(interval);
              playSound(hajimeBuffer, 'hajime');
              setCurrentScreen('hajime');
              return 0;
            }
            if (prev <= 4) {
              playSound(beepBuffer, 'beep');
            }
            return prev - 1;
          });
        }, 1000);

        return () => clearInterval(interval);
      }, [setCurrentScreen, playSound, beepBuffer, hajimeBuffer]);

      return (
        <div className="flex flex-col items-center justify-center h-screen w-screen p-6 bg-midnight-green text-mint-cream overflow-hidden select-none">
          <h1 className="text-3xl font-bold mb-4">Get Ready</h1>
          <div className="relative flex items-center justify-center">
            <svg width="300" height="300" className="timer-circle">
              <circle
                cx="150"
                cy="150"
                r="75"
                stroke="#f7fff7"
                strokeWidth="4"
                fill="none"
                className="timer-circle-path-10s"
              />
            </svg>
            <div className="absolute text-8xl font-bold">{timer}</div>
          </div>
        </div>
      );
    };

    const InfoScreen = ({ setCurrentScreen }) => {
      return (
        <div className="flex flex-col items-center justify-center h-screen w-screen p-6 bg-midnight-green text-mint-cream overflow-hidden select-none">
          <h1 className="text-3xl font-bold mb-4">Info</h1>
          <p className="text-lg text-center max-w-full">Info-Seite wird geladen...</p>
          <button
            className="fixed bottom-4 left-1/2 -translate-x-1/2 w-12 h-12 rounded-full bg-gradient-to-br from-red-600 to-light_red text-mint-cream text-xl font-light flex items-center justify-center shadow-inner shadow-sm hover:shadow-inner transition"
            onClick={() => {
              console.log('Navigating to start from Info');
              setCurrentScreen('start');
            }}
          >
            X
          </button>
        </div>
      );
    };

    const AttacksScreen = ({ categories, selectedCategories, setSelectedCategories, setCurrentScreen, isAutoModeEnabled }) => {
      const toggleCategory = (category) => {
        setSelectedCategories((prev) =>
          prev.includes(category)
            ? prev.filter((c) => c !== category)
            : [...prev, category]
        );
      };

      return (
        <div className="flex flex-col items-center justify-start h-screen w-screen p-6 bg-midnight-green text-mint-cream overflow-hidden select-none">
          <h1 className="text-3xl font-bold mb-4 pt-8">Angriffe</h1>
          <div className="flex flex-col gap-4 w-full max-w-md overflow-y-auto">
            {categories.map((category) => (
              <div key={category} className="flex items-center justify-between">
                <span className="text-lg">{category}</span>
                <button
                  className={`w-12 h-6 rounded-full p-1 flex items-center transition-colors ${
                    selectedCategories.includes(category) ? 'bg-robin_egg_blue' : 'bg-gray-400'
                  }`}
                  onClick={() => toggleCategory(category)}
                >
                  <div
                    className={`w-4 h-4 rounded-full bg-white shadow-md transform transition-transform ${
                      selectedCategories.includes(category) ? 'translate-x-6' : 'translate-x-0'
                    }`}
                  ></div>
                </button>
              </div>
            ))}
          </div>
          <button
            className="fixed bottom-4 left-1/2 -translate-x-1/2 w-12 h-12 rounded-full bg-gradient-to-br from-red-600 to-light_red text-mint-cream text-xl font-light flex items-center justify-center shadow-inner shadow-sm hover:shadow-inner transition"
            onClick={() => {
              console.log('Navigating to', isAutoModeEnabled ? 'defensePrep' : 'start', 'from Attacks');
              setCurrentScreen(isAutoModeEnabled ? 'defensePrep' : 'start');
            }}
          >
            X
          </button>
        </div>
      );
    };

    const DefenseScreen = ({ defenseCategories, selectedDefenseCategories, setSelectedDefenseCategories, setCurrentScreen, isAutoModeEnabled }) => {
      const toggleCategory = (category) => {
        setSelectedDefenseCategories((prev) =>
          prev.includes(category)
            ? prev.filter((c) => c !== category)
            : [...prev, category]
        );
      };

      return (
        <div className="flex flex-col items-center justify-start h-screen w-screen p-6 bg-midnight-green text-mint-cream overflow-hidden select-none">
          <h1 className="text-3xl font-bold mb-4 pt-8">Abwehr</h1>
          <div className="flex flex-col gap-4 w-full max-w-md overflow-y-auto">
            {defenseCategories.map((category) => (
              <div key={category} className="flex items-center justify-between">
                <span className="text-lg">{category}</span>
                <button
                  className={`w-12 h-6 rounded-full p-1 flex items-center transition-colors ${
                    selectedDefenseCategories.includes(category) ? 'bg-robin_egg_blue' : 'bg-gray-400'
                  }`}
                  onClick={() => toggleCategory(category)}
                >
                  <div
                    className={`w-4 h-4 rounded-full bg-white shadow-md transform transition-transform ${
                      selectedDefenseCategories.includes(category) ? 'translate-x-6' : 'translate-x-0'
                    }`}
                  ></div>
                </button>
              </div>
            ))}
          </div>
          <button
            className="fixed bottom-4 left-1/2 -translate-x-1/2 w-12 h-12 rounded-full bg-gradient-to-br from-red-600 to-light_red text-mint-cream text-xl font-light flex items-center justify-center shadow-inner shadow-sm hover:shadow-inner transition"
            onClick={() => {
              console.log('Navigating to', isAutoModeEnabled ? 'getReady' : 'start', 'from Defense');
              setCurrentScreen(isAutoModeEnabled ? 'getReady' : 'start');
            }}
          >
            X
          </button>
        </div>
      );
    };

    const UkeScreen = ({ attacks, selectedCategories, setCurrentScreen, setLastAttack }) => {
      if (!attacks || attacks.length === 0) {
        console.log('No attacks loaded');
        return (
          <div className="flex flex-col items-center justify-center h-screen w-screen bg-midnight-green text-mint-cream">
            <h1 className="text-3xl font-bold">Fehler</h1>
            <p className="text-lg text-center mt-4">Keine Angriffe.</p>
          </div>
        );
      }

      const filteredAttacks = attacks.filter((attack) =>
        selectedCategories.includes(attack.category)
      );

      if (filteredAttacks.length === 0) {
        return (
          <div className="flex flex-col items-center justify-center h-screen w-screen bg-midnight-green text-mint-cream">
            <h1 className="text-3xl font-bold">Fehler</h1>
            <p className="text-lg text-center mt-4">Keine Angriffe in den ausgewählten Kategorien.</p>
            <button
              className="fixed bottom-4 left-1/2 -translate-x-1/2 w-12 h-12 rounded-full bg-gradient-to-br from-red-600 to-light_red text-mint-cream text-xl font-light flex items-center justify-center shadow-inner shadow-sm hover:shadow-inner transition"
              onClick={() => {
                console.log('Navigating to start from Uke');
                setCurrentScreen('start');
              }}
            >
              X
            </button>
          </div>
        );
      }

      const [randomAttack, setRandomAttack] = React.useState(
        filteredAttacks[Math.floor(Math.random() * filteredAttacks.length)]
      );

      React.useEffect(() => {
        const newRandomAttack = filteredAttacks[Math.floor(Math.random() * filteredAttacks.length)];
        setRandomAttack(newRandomAttack);
        setLastAttack(newRandomAttack);
        console.log('Updated lastAttack:', newRandomAttack);
      }, [selectedCategories, setLastAttack]);

      return (
        <div className="flex flex-col items-center justify-center h-screen w-screen p-6 bg-midnight-green text-mint-cream overflow-hidden select-none">
          <h1 className="text-3xl font-bold mb-4">{randomAttack.category}</h1>
          <h2 className="text-2xl font-semibold text-center mb-4">{randomAttack.attack}</h2>
          <p className="text-lg text-center max-w-full">{randomAttack.explanation}</p>
          <button
            className="fixed bottom-4 left-1/2 -translate-x-1/2 w-12 h-12 rounded-full bg-gradient-to-br from-red-600 to-light_red text-mint-cream text-xl font-light flex items-center justify-center shadow-inner shadow-sm hover:shadow-inner transition"
            onClick={() => {
              console.log('Navigating to start from Uke');
              setCurrentScreen('start');
              setRandomAttack(filteredAttacks[Math.floor(Math.random() * filteredAttacks.length)]);
            }}
          >
            X
          </button>
        </div>
      );
    };

    const ToriScreen = ({ techniques, selectedDefenseCategories, setCurrentScreen, setLastTechnique }) => {
      if (!techniques || techniques.length === 0) {
        console.log('No techniques loaded');
        return (
          <div className="flex flex-col items-center justify-center h-screen w-screen bg-midnight-green text-mint-cream">
            <h1 className="text-3xl font-bold">Fehler</h1>
            <p className="text-lg text-center mt-4">Keine Techniken geladen. Bitte überprüfe data.json.</p>
          </div>
        );
      }

      const filteredTechniques = techniques.filter((technique) =>
        selectedDefenseCategories.includes(technique.category)
      );

      if (filteredTechniques.length === 0) {
        return (
          <div className="flex flex-col items-center justify-center h-screen w-screen bg-midnight-green text-mint-cream">
            <h1 className="text-3xl font-bold">Fehler</h1>
            <p className="text-lg text-center mt-4">Keine Techniken in den ausgewählten Kategorien.</p>
            <button
              className="fixed bottom-4 left-1/2 -translate-x-1/2 w-12 h-12 rounded-full bg-gradient-to-br from-red-600 to-light_red text-mint-cream text-xl font-light flex items-center justify-center shadow-inner shadow-sm hover:shadow-inner transition"
              onClick={() => {
                console.log('Navigating to start from Tori');
                setCurrentScreen('start');
              }}
            >
              X
            </button>
          </div>
        );
      }

      const [randomTechnique, setRandomTechnique] = React.useState(
        filteredTechniques[Math.floor(Math.random() * filteredTechniques.length)]
      );

      React.useEffect(() => {
        const newRandomTechnique = filteredTechniques[Math.floor(Math.random() * filteredTechniques.length)];
        setRandomTechnique(newRandomTechnique);
        setLastTechnique(newRandomTechnique);
        console.log('Updated lastTechnique:', newRandomTechnique);
      }, [selectedDefenseCategories, setLastTechnique]);

      return (
        <div className="flex flex-col items-center justify-center h-screen w-screen p-6 bg-midnight-green text-mint-cream overflow-hidden select-none">
          <h1 className="text-3xl font-bold mb-4 text-center">{randomTechnique.category}</h1>
          <h2 className="text-2xl font-semibold text-center mb-4">{randomTechnique.technique}</h2>
          <button
            className="fixed bottom-4 left-1/2 -translate-x-1/2 w-12 h-12 rounded-full bg-gradient-to-br from-red-600 to-light_red text-mint-cream text-xl font-light flex items-center justify-center shadow-inner shadow-sm hover:shadow-inner transition"
            onClick={() => {
              console.log('Navigating to start from Tori');
              setCurrentScreen('start');
              setRandomTechnique(filteredTechniques[Math.floor(Math.random() * filteredTechniques.length)]);
            }}
          >
            X
          </button>
        </div>
      );
    };

    const HajimeScreen = ({ lastAttack, lastTechnique, setCurrentScreen, isHajimeCounterEnabled, playSound, beepBuffer, hajimeBuffer }) => {
      const [timer, setTimer] = React.useState(5);
      const [showTimer, setShowTimer] = React.useState(isHajimeCounterEnabled);

      React.useEffect(() => {
        if (!isHajimeCounterEnabled) {
          setShowTimer(false);
          return;
        }

        const interval = setInterval(() => {
          setTimer((prev) => {
            if (prev <= 1) {
              clearInterval(interval);
              playSound(hajimeBuffer, 'hajime');
              setShowTimer(false);
              return 0;
            }
            if (prev <= 4) {
              playSound(beepBuffer, 'beep');
            }
            return prev - 1;
          });
        }, 1000);

        return () => clearInterval(interval);
      }, [isHajimeCounterEnabled, playSound, beepBuffer, hajimeBuffer]);

      if (showTimer) {
        return (
          <div className="flex flex-col items-center justify-center h-screen w-screen p-6 bg-midnight-green text-mint-cream overflow-hidden select-none">
            <div className="relative flex items-center justify-center">
              <svg width="300" height="300" className="timer-circle">
                <circle
                  cx="150"
                  cy="150"
                  r="75"
                  stroke="#f7fff7"
                  strokeWidth="4"
                  fill="none"
                  className="timer-circle-path"
                />
              </svg>
              <div className="absolute text-8xl font-bold">{timer}</div>
            </div>
          </div>
        );
      }

      return (
        <div className="flex flex-col items-center justify-center h-screen w-screen p-4 bg-midnight-green text-mint-cream overflow-hidden select-none">
          <div className="flex flex-col items-center justify-center h-1/4 w-full">
            {lastAttack ? (
              <>
                <h1 className="text-3xl font-bold mb-0 text-center">{lastAttack.category}</h1>
                <h2 className="text-2xl font-semibold text-center">{lastAttack.attack}</h2>
              </>
            ) : (
              <p className="text-lg text-center">Kein Angriff gezogen</p>
            )}
          </div>
          <div className="w-4/5 border-t border-mint-cream my-4"></div>
          <div className="flex flex-col items-center justify-center h-1/4 w-full">
            {lastTechnique ? (
              <>
                <h1 className="text-3xl font-bold mb-0 text-center">{lastTechnique.category}</h1>
                <h2 className="text-2xl font-semibold text-center">{lastTechnique.technique}</h2>
              </>
            ) : (
              <p className="text-lg text-center">Keine Technik gezogen</p>
            )}
          </div>
          <button
            className="fixed bottom-4 left-1/2 -translate-x-1/2 w-12 h-12 rounded-full bg-gradient-to-br from-red-600 to-light_red text-mint-cream text-xl font-light flex items-center justify-center shadow-inner shadow-sm hover:shadow-inner transition"
            onClick={() => {
              console.log('Navigating to start from Hajime');
              setCurrentScreen('start');
            }}
          >
            X
          </button>
        </div>
      );
    };

    const App = () => {
      const [currentScreen, setCurrentScreen] = React.useState('start');
      const [data, setData] = React.useState({ attacks: [], techniques: [] });
      const [lastAttack, setLastAttack] = React.useState(null);
      const [lastTechnique, setLastTechnique] = React.useState(null);
      const [loading, setLoading] = React.useState(true);
      const [error, setError] = React.useState(null);
      const [selectedCategories, setSelectedCategories] = React.useState(
        JSON.parse(localStorage.getItem('selectedCategories')) || []
      );
      const [selectedDefenseCategories, setSelectedDefenseCategories] = React.useState(
        JSON.parse(localStorage.getItem('selectedDefenseCategories')) || []
      );
      const [isHajimeCounterEnabled, setIsHajimeCounterEnabled] = React.useState(
        localStorage.getItem('hajimeCounterEnabled') === 'true'
      );
      const [isAutoModeEnabled, setIsAutoModeEnabled] = React.useState(
        localStorage.getItem('autoModeEnabled') === 'true'
      );
      const [audioContext, setAudioContext] = React.useState(null);
      const [beepBuffer, setBeepBuffer] = React.useState(null);
      const [hajimeBuffer, setHajimeBuffer] = React.useState(null);

      const playSound = (buffer, soundName) => {
        if (!audioContext || !buffer) {
          console.warn(`Cannot play ${soundName}: AudioContext or buffer not ready`);
          return;
        }
        const source = audioContext.createBufferSource();
        source.buffer = buffer;
        source.connect(audioContext.destination);
        source.start(0);
        console.log(`${soundName} audio played successfully`);
        source.onended = () => {
          console.log(`${soundName} audio ended`);
        };
      };

      React.useEffect(() => {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        setAudioContext(ctx);

        const loadAudio = async (url, setBuffer) => {
          try {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Failed to fetch ${url}: ${response.status}`);
            const arrayBuffer = await response.arrayBuffer();
            const audioBuffer = await ctx.decodeAudioData(arrayBuffer);
            setBuffer(audioBuffer);
            console.log(`Loaded ${url} into buffer`);
          } catch (e) {
            console.error(`Error loading ${url}:`, e.message);
          }
        };

        loadAudio('./assets/sounds/beep.mp3', setBeepBuffer);
        loadAudio('./assets/sounds/hajime.mp3', setHajimeBuffer);

        return () => {
          ctx.close().then(() => console.log('AudioContext closed'));
        };
      }, []);

      React.useEffect(() => {
        console.log('App initialized', { audioContext, beepBuffer, hajimeBuffer });
        const dataUrl = 'https://erikstadel.github.io/RandomAttack/data.json';
        console.log(`Fetching ${dataUrl}`);
        fetch(`${dataUrl}?cacheBust=${Date.now()}`)
          .then(response => {
            console.log('Response status:', response.status);
            if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
            return response.json();
          })
          .then(data => {
            console.log('Data loaded:', data);
            setData(data);
            const attackCategories = [...new Set(data.attacks.map((attack) => attack.category))];
            const defenseCategories = [...new Set(data.techniques.map((technique) => technique.category))];
            setSelectedCategories((prev) => {
              const saved = JSON.parse(localStorage.getItem('selectedCategories'));
              return saved && saved.length > 0 ? saved : attackCategories;
            });
            setSelectedDefenseCategories((prev) => {
              const saved = JSON.parse(localStorage.getItem('selectedDefenseCategories'));
              return saved && saved.length > 0 ? saved : defenseCategories;
            });
            setLoading(false);
          })
          .catch(error => {
            console.error('Error loading data:', error);
            setError(error.message);
            setLoading(false);
          });
      }, []);

      React.useEffect(() => {
        localStorage.setItem('hajimeCounterEnabled', isHajimeCounterEnabled);
      }, [isHajimeCounterEnabled]);

      React.useEffect(() => {
        localStorage.setItem('autoModeEnabled', isAutoModeEnabled);
      }, [isAutoModeEnabled]);

      React.useEffect(() => {
        localStorage.setItem('selectedCategories', JSON.stringify(selectedCategories));
      }, [selectedCategories]);

      React.useEffect(() => {
        localStorage.setItem('selectedDefenseCategories', JSON.stringify(selectedDefenseCategories));
      }, [selectedDefenseCategories]);

      React.useEffect(() => {
        console.log('Current screen:', currentScreen);
      }, [currentScreen]);

      if (loading) {
        return <div className="flex items-center justify-center h-screen w-screen bg-midnight-green text-mint-cream">Lade...</div>;
      }

      if (error) {
        return (
          <div className="flex flex-col items-center justify-center h-screen w-screen bg-midnight-green text-mint-cream">
            <h1 className="text-3xl font-bold">Fehler</h1>
            <p className="text-lg text-center mt-4">Fehler beim Laden der Daten: {error}</p>
            <button
              className="mt-4 px-4 py-2 bg-robin_egg_blue text-white rounded hover:bg-robin_egg_blue-600"
              onClick={() => setCurrentScreen('start')}
            >
              Zurück
            </button>
          </div>
        );
      }

      const attackCategories = [...new Set(data.attacks.map((attack) => attack.category))];
      const defenseCategories = [...new Set(data.techniques.map((technique) => technique.category))];

      return (
        <div className="h-screen w-screen">
          {currentScreen === 'start' && (
            <StartScreen
              setCurrentScreen={setCurrentScreen}
              isHajimeCounterEnabled={isHajimeCounterEnabled}
              isAutoModeEnabled={isAutoModeEnabled}
              playSound={playSound}
              hajimeBuffer={hajimeBuffer}
            />
          )}
          {currentScreen === 'info' && <InfoScreen setCurrentScreen={setCurrentScreen} />}
          {currentScreen === 'attacks' && (
            <AttacksScreen
              categories={attackCategories}
              selectedCategories={selectedCategories}
              setSelectedCategories={setSelectedCategories}
              setCurrentScreen={setCurrentScreen}
              isAutoModeEnabled={isAutoModeEnabled}
            />
          )}
          {currentScreen === 'defense' && (
            <DefenseScreen
              defenseCategories={defenseCategories}
              selectedDefenseCategories={selectedDefenseCategories}
              setSelectedDefenseCategories={setSelectedDefenseCategories}
              setCurrentScreen={setCurrentScreen}
              isAutoModeEnabled={isAutoModeEnabled}
            />
          )}
          {currentScreen === 'settings' && (
            <SettingsScreen
              isHajimeCounterEnabled={isHajimeCounterEnabled}
              setIsHajimeCounterEnabled={setIsHajimeCounterEnabled}
              isAutoModeEnabled={isAutoModeEnabled}
              setIsAutoModeEnabled={setIsAutoModeEnabled}
              setCurrentScreen={setCurrentScreen}
            />
          )}
          {currentScreen === 'uke' && (
            <UkeScreen
              attacks={data.attacks}
              selectedCategories={selectedCategories}
              setCurrentScreen={setCurrentScreen}
              setLastAttack={setLastAttack}
            />
          )}
          {currentScreen === 'tori' && (
            <ToriScreen
              techniques={data.techniques}
              selectedDefenseCategories={selectedDefenseCategories}
              setCurrentScreen={setCurrentScreen}
              setLastTechnique={setLastTechnique}
            />
          )}
          {currentScreen === 'hajime' && (
            <HajimeScreen
              lastAttack={lastAttack}
              lastTechnique={lastTechnique}
              setCurrentScreen={setCurrentScreen}
              isHajimeCounterEnabled={isHajimeCounterEnabled}
              playSound={playSound}
              beepBuffer={beepBuffer}
              hajimeBuffer={hajimeBuffer}
            />
          )}
          {currentScreen === 'attacker' && (
            <AttackerScreen setCurrentScreen={setCurrentScreen} />
          )}
          {currentScreen === 'defensePrep' && (
            <DefensePrepScreen setCurrentScreen={setCurrentScreen} />
          )}
          {currentScreen === 'getReady' && (
            <GetReadyScreen
              setCurrentScreen={setCurrentScreen}
              playSound={playSound}
              beepBuffer={beepBuffer}
              hajimeBuffer={hajimeBuffer}
            />
          )}
        </div>
      );
    };

    tailwind.config = {
      theme: {
        extend: {
          colors: {
            midnight_green: '#233d4d',
            robin_egg_blue: '#4ecdc4',
            mint_cream: '#f7fff7',
            light_red: '#ff6b6b',
            naples_yellow: '#ffe66d',
          },
        },
      },
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>